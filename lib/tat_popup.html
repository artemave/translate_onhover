<template id="transover-tat-popup-template">
  <style>
    #tat_input_container {
      display: flex;
      margin-bottom: 10px;
    }

    #tat_input_container label {
      line-height: 26px;
    }

    #tat_input {
      margin-left: 5px;
      flex-grow: 2;
      font-size: 15px;
      line-height: 20px;
      border-radius: 2px;
      border: 1px #ccc solid;
      padding-left: 5px;
    }

    #tat_submit_container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #tat_submit_container select {
      margin-left: 5px;
    }

    #tat_submit {
      width: 45px;
      margin-left: 5px;
    }

    #tat_to_lang {
      width: 150px;
    }

    #swap_languages {
      margin-left: 5px;
      margin-right: 5px;
      width: 24px;
      height: 24px;
      background-repeat: no-repeat;
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAEKElEQVR4nL1Vb0xbVRQ/97Xre23pn9FSNmBQGEqGMJQPIyU6MkMczf6gbAyNk5lo9gkTdTPGLPswzRITjcYPftREiYQ/g5EVZZEwNt3ELBmiI/wLqB1rFdaWDaSjfe+e44cHpUAL0URPcnPuu/e887vn3PM7F+A/Fs1mBi+fbNBXPHNgv6ShCa/X+48BhI02T7522lbmrrtsTct8RRCETQ+TSLTJNhreOuvcXXG4y2C1F874vL25BcWP5hWWKgQEAABKNBJZmAvNzIaCi1d6vqVkfliixdfPnH+8eO9BzxaDKQuRgCMRR2KcYhoQgaKRh/PBO+O90yM/fhTy/faD51InrvW1LuzT5z6sLKo4/LVGZ3AoSMARQEEChYgpSKAgMa5qQKaRREvaLmteST0jlHIc5usjw8M8KUBN3Yu2soP1fYLOkLrkDJadxb5pWQMgESASIDHBsC3vSR4Ja3fYUq6OjY1SQoBUq3kxHPT/lJpdUAVaMYUjMQWJKbR8clA1qWniBAyJGKpgTHLklC3cHb469POANyHA1NQUDN66+atNxCuWjJ2VgmhUI+EICkfkiKQOIiRgSKDexxIAAtMQoikjRbg4Pj6OAEmq6KsvPhuok6P7H3n6+ZaUdGep/5fv+vyDfe8AQCy/Wslo3+567n3Rnl1CKgAhEOgceeU6UbQCQCApAABAS1PjZC2XD2S7qr9EpPCD+7MDPT09SrzNcYNFdpQfuUgEAhIBEQAJGpEBmDcFAABoa2mePopYK5pt+2RZXleCi0HftTueTx4jIi1jasUTESHiH8s2MR68cea9Ap1kLCHVCJAAwnOh6ZnfR79vb29f5fzZupcMzpLyd32D1862tTY/3OiQsQiMVvuhQlfVB5xWiPUgOO0LTE3sAQD/qr+4rE0v2vsm0xmdxwTh1dbmpvubAoT+nLotq45haZBoScsorjrRkbn7qTZgQjSWZ0JJQYKtO5+oYaIx7ZigeaG1qdGfCCCWopqjtcZ99W+P64yWDI5EnFTGokou4kgMCUite4L4eTjgG/Jfv1Db3Pj56FqAGA9Ghofl/DynvDV7l3ulJQAotBRRHKEwvvaJQCOZ0vQZ+dW5Nn3/0OCtuwkBAAC228yDW/TGfL0ts4gvMZivtIV49sJaMNLqTJGQb36bReqdnJxM3CrGRkd5ulFzWYkuSnr7jlICjSbOGSzPOREgrKwpclS+13/h47Bv7LzH41lVVQnbtdvt1phT7SXWnKLjkj1rj6DTpxKBQKS+BgRMEB25+UjElMW/Fu7daD0XCfk/7ejoCCe95ETicrmYyWQSRVHUQdzrJ6WYTVmHTnmj88HZwI2WU5G5QFNnZ2c0kY8NAZKJu/qI2Vl54nawv60hPDf7TVdXF09m+6/eWafTyWlm4tLcbOBmd3f3uhbyv8rfG8mfJ968lFgAAAAASUVORK5CYII=);
      cursor: pointer;
    }

    #swap_languages.disabled {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAEIklEQVR4nL1VX0hbVxj/7k0w6TS3QVck+qC2/tfhiMyRUR8GlU4XNzJYsFBUluXBh/Uho0PBPWww6TbEpzGz+pKBC2OS2tkHRbQd3ZiIdkoVghptdO2MRmP+3Xtzb+759nBNFl0S8WH7weF+nO+7v985h/P7DsB/DMVZBTab7YLJZLouCMKG1+s9twCdLdnf31/Q09MzWVZWZqFp+szFpIMyU2JgYKC0s7Pzga6oqHZ9fX2msbGx0mAwxBN5juNi+/v7e36/n5+cnMRzqQ4NDb3q9/t3JEnCuCRhPB4noiiiIIgkJggYi8WQ53lycHgYnJmddfX29l41mUxZTyMJu91+LRKJBCSZGEVRREEUiSATE57nkeM4ZFmWRKNRjEQieHQUFO+OjAyYzWbVab4T59rd3V1gs9ke5ubm5iMAACJgckBKfHIAIF1TW3s1HAopc3JyHrndbkwrkJeXx29sbPyh1+vfuqBW5yEChYDUMVHql0LyT0wQAZFQlZVVry8sLDxaXFzwphXY3t6Gubm5zXA4PFtXV3eNYZh8RASJEJDiEiESQXlIeCxMISIQJICIFEVRCkmSNKIo3FtbWyMAGW6R3W5/wvP89Y9u3fqxprpG/2Bi4qHL5eoDAClRwzDMyxaL5U55RWUDIgEkiAQRqqqr31CpVFoA8GcUAABwOBweQRDetlgs30uEsIFA4Mn09HQ8tSY/v0C0Wq33CCItHx8BhUKhAgDmTAEAAKfT6ZMk6X2dTvemKIrkdP7Zs61f+vp66xBRSVEUAAAgIhJC/krUUIlgcHCwimGYBvlWyNjb2/MtLS09HhsbO0H+gcXyUktLy+c/37//qdPp5LItMrkDnU7X3tHR8fWxACIitbOz83xlZaUJAF6k/hTjeeU77e02RqMppWn6w9HR0aMzBTwez1OUAQmN4uLiotu3P3EZjcafaJoWjueBEKImBKG5ufk9jUZzSalU3nA4HC8yiQAAgNlszt3d3X0utwSByO0ghhzHI8txJMqyGIlESTgcwVAojMFgiBwdBfEwEMCFxcWnVqu1Oh1v0gerq6tiSUmJqG9sbEXZtgljATltNJKcpxAJXGQuXqqvf+VdmqZ/n5+f/zOtAACAWq1eYhim/HJZWT1mEiAJc8nuRSLHOSqVZmtrM6xUKmc8Hk/6VuF2uyVBECZZllWXV1ToFbRCkeJUOBZIkCdjnuPEkbvfDS0vL38xMTFx4lZRkAatra2KwsLChteamm5euXylSW5+CTMhUEDRVdVV5YQgFQoGo8P24c+2vd5vXC4Xe5orrUACBoOB0mg0KpVKlQMpr59Wq9Xc+fIrr8/nC9iHv/3Y5/P9MD4+LmTjOhfMZjPz+NffvF1dXe1GozHrU5p1B5nQ1tam1Gq1pQcHB5tTU1P/aiH/K/4G7RvFhRjTPe0AAAAASUVORK5CYII=);
      cursor: auto;
    }

    main {
      color: #333;
      font-family: Arial, sans-serif;
      font-size: 16px;
      font-weight: 300;
      line-height: 19px;
      width: 420px;

      background: #fcf7d9;
      text-align: left;
      border-style: solid;
      border-width: 1px;
      border-color: #ccc;
      box-shadow: rgba(0,0,0,0.2) 0px 2px 5px;
      border-radius: 5px;
      padding: 10px 10px 8px 10px;
      position: fixed;
      z-index: 2147483647;
      top: 15px;
      right: 15px;
    }
  </style>

  <main>
    <div id="tat_input_container">
      <label for="tat_from_lang">Translate</label>
      <input id="tat_input" type="text"/>
    </div>
    <div id="tat_submit_container">
      <label for="tat_from_lang">from</label>
      <select id="tat_from_lang"></select>

      <div id="swap_languages"></div>

      <label for="tat_to_lang">into</label>
      <select id="tat_to_lang"></select>

      <input type="submit" id="tat_submit" value="go" />
    </div>
  </main>
</template>

<script>
(function() {
  var owner = document.currentScript.ownerDocument;

  var PopupProto = Object.create(HTMLElement.prototype);

  PopupProto.q = function(selector) {
    return this.shadowRoot.querySelector(selector);
  }

  PopupProto.createdCallback = function() {
    var t = owner.querySelector('#transover-tat-popup-template').content.cloneNode(true);
    this.createShadowRoot().appendChild(t);

    var sendTranslate = function() {
      window.postMessage({
        type: 'transoverTranslate',
        text: this.q('#tat_input').value,
        to: this.q('#tat_to_lang').value,
        from: this.q('#tat_from_lang').value
      }, '*');
    }.bind(this);

    this.q('#swap_languages').onclick = function() {
      if (this.q('#swap_languages').classList.contains('disabled'))
        return;

      var to_select = this.q('#tat_to_lang');
      var from_select = this.q('#tat_from_lang');
      var to_value = to_select.value;

      to_select.value = from_select.value;
      from_select.value = to_value;
    }.bind(this)

    this.q('#tat_from_lang').onchange = function() {
      if (this.q('#tat_from_lang').value == 'auto') {
        this.q('#swap_languages').classList.add('disabled');
      } else {
        this.q('#swap_languages').classList.remove('disabled');
      }
    }.bind(this)

    this.q('main').onkeydown = function(e) {
      if (e.keyCode == 13) {
        sendTranslate();
      }
    }

    this.q('#tat_submit').onclick = sendTranslate;
  };

  PopupProto.attachedCallback = function() {
    this.q('#tat_input').focus();
  }

  PopupProto.attributeChangedCallback = function(attribute, oldVal, newVal) {
    if (attribute == "data-languages") {
      var from_select = this.q('#tat_from_lang');
      var to_select = this.q('#tat_to_lang');
      var languages = JSON.parse(newVal);
      var select_auto = true;

      for (var key in languages) {
        var from_option = new Option(languages[key].label, key);
        var to_option = new Option(languages[key].label, key);

        if (languages[key].selected_sl) {
          select_auto = false;
          from_option.setAttribute('selected', true);
        }
        if (languages[key].selected_tl) {
          to_option.setAttribute('selected', true);
        }

        from_select.appendChild(from_option);
        to_select.appendChild(to_option);
      }

      var auto_option = new Option('Autodetect', 'auto');
      from_select.insertBefore(auto_option, from_select.firstChild);
      if (select_auto) {
        auto_option.setAttribute('selected', true);
        this.q('#swap_languages').classList.add('disabled');
      }
    }
  };

  document.registerElement('transover-type-and-translate-popup', { prototype: PopupProto });
})();
</script>
